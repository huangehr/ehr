健康档案资源化方案
====================

> 作者：温富建，2016.03.01
> 参与：罗发强，沈在鑫，李有星，陈维山
> 修订：温富建，2016.03.08

概述
---------------------

在分析问题之前先看两个原则

#### 健康档案数据标准制定原则

> 内部交互，以细粒度数据集为单位，包括数据采集

> 外部交互，以健康档案为单位

> 数据元与数据集只允许增加（在标识命名空间按规定编码），不允许删除，但可以作废

但是在健康档案数据标准0.1版本制作时并未完全遵守此规范，主要具体问题：

- 混合了CDA文档，比如病案首页
- 数据集分配不规范：出院诊断与入院诊断有单独的数据集，但是其他的诊断却没有一个独立的数据集，正常情况是所有的诊断合并为一个数据集

#### 健康档案资源化规则

> 静态数据以数据集为蓝本

> 动态数据根据业务规则生成

二者共同形成资源视图。

#### 问题

当资源化时，由于数据标准的不一致性，无法将数据以简单的规则整合成统一的资源。例如，由于诊断数据在前后版本的数据分散位置不一致，
无法将所有的诊断以同一个数据集的方式统一做整合，又因为对前端应用及用户（患者，医生）而言数据没有版本概念，对外提供数据时不需要加外版本号，
造成无法直接使用资源化的数据。

解决方案及优缺点讨论
---------------------

鉴于数据无法资源化的原因是由于“数据标准未按制定原则”制订而使得资源化时需要合并不同标准数据造成的。我们提出两种处理方案

### 方案一：尊重历史版本数据，按主题制作静态化资源

此方案出发点是以后的数据标准无法按原则制订。在这种情况下，在资源化时无法使用直接映射，但使用动态逻辑合并数据显然也是不现实的，
因此只能选择按主题静态化资源数据。比如：按业务主题将数据全部抽取到MySQL中，使用关系型数据库提高数据使用效率。

#### 优点

不用顾忌标准数据制订的散乱及不可预料的结构变更，根据主题抽取所需要的数据

#### 缺点

数据存储将是平台的巨大负担，若主题有变更，所有的数据均需要重新抽取，巨量数据将严重占用平台资源。

### 方案二：整理0.1版数据，以1.0版本为准，新数据标准制定严格按照原则制订，资源生成“切片”化。

这里面包含两个内容：以1.0数据为准，整理0.1版数据为1.0版本；资源生成“切片”化。

#### 整理0.1版数据

此方案的出发点是1.0版本的数据是经过实践检验的，对门诊/住院数据标准做了更合理的划分，将病案首页数据集作废（病案首页的数据其实是就诊数据的汇总），
增加费用，诊断（合并出院诊断与入院诊断数据集）及护理体征数据集。

对于0.1版本数据：

- 病案首页部分可以拆分至其他数据集
- 入院诊断与出院诊断整合至诊断数据集

此方案实行后，以后的数据标准必须严格按原则制订，**产品部**需要集中精力应付每次业务领域扩展时数据标准的制订工作。

#### 资源生成“切片”化

在完全遵守数据标准扩展的原则上，对数据资源化的工作更多集中在数据视图逻辑的制作上，视图采取“动静结合方式”。

对原始数据，资源化时遵守原始数据集标准，将数据映射到资源视图中，此方法可以减少数据冗余。

对于动态数据，为减少数据冗余采取以下策略：

- 档案上传之后的预设时间范围内，通过接口监测观察患者的数据访问频率及内容（定制活跃度），预筛选需要做静态化数据的患者及数据范围
- 对需要静态化数据的活跃患者，将预设时间范围内（如：一年）的健康数据做抽取（增量式），并在前端应用提示当前已经静态化处理的数据范围
- 面向医护统计的专题数据单独开后台做静态化
- 面向企业级数据统计目前不在考虑范围内

术语：

- 活跃度：患者数据被访问的频率
- 增量式：统计数据需要能够可迭代
- 数据范围：需要被静态化的数据内容（不包含原始数据）

#### 优点

- 原始数据不用二次存储数据，减少数据冗余
- 对活跃患者做静态化，可以提高用户服务精准度

#### 缺点

若对资源化的业务逻辑效率低，会影响用户体验。

对比
---------------------

<table>
  <tr>
    <th class="tg-yw4l">方案</th>
    <th class="tg-yw4l">标准修改（不遵守原则）</th>
    <th class="tg-yw4l">原始数据二次存储</th>
    <th class="tg-yw4l">数据提取效率</th>
  </tr>
  <tr>
    <td class="tg-yw4l">方案一</td>
    <td class="tg-yw4l">重新抽取资源化的数据量大</td>
    <td class="tg-yw4l">根据专题抽取做二次存储</td>
    <td class="tg-yw4l">快</td>
  </tr>
  <tr>
    <td class="tg-yw4l">方案二</td>
    <td class="tg-yw4l">重新抽取资源化的数据量小</td>
    <td class="tg-yw4l">活跃患者的统计数据存储</td>
    <td class="tg-yw4l">根据患者活跃情况决定</td>
  </tr>
</table>
