REST API调用规范
====================

本文档为平台REST API调用规范，旨在为第三方应用提供访统一的问平台调用与交互方式，通过这些接口可以访问患者的健康数据，医疗资源及医疗机构等数据。

API采用REST基础的接口规范，所有API都是通过向平台的REST服务器发送HTTP请求来实现，REST服务器支持gzip，可有效降低网络开销，建议第三方应用加入gzip支持。 

支持的HTTP请求方法
---------------------

大多数API都支持POST和GET两种方法，但因为Web服务器对于请求URL长度有限制，对于数据提交类API，我们仅支持POST方法，
同时将部分系统参数放在REST请求URL地址的Query参数中（下面会详细说明）。 

REST服务器地址
---------------------

鉴于平台产品的多样性，API的REST服务器地址并不唯一，例如，健康档案的服务器地址与数据管理的服务器地址就不一样，具体的可以参见各网关API说明。

术语解释
---------------------

- App Key: 在平台注册App时，由平台提供的唯一App标识（ID）
- App Secret：在平台注册App时与App Key同时分配的应用密钥（密码），用于平台与合作应用之间的参数签名，保证传输参数的不可伪造性。
- 用户ID：在平台注册用户时，由平台提供的唯一用户标识
- 用户密码：与用户ID相匹配的用户密码，由用户保管
- 机构代码：在平台注册机构时，此机构在国家注册的机构代码
- 机构公钥：在平台注册时，平台为机构提供的公钥。

返回值
---------------------

若调用正常进行，返回值均以JSON格式返回，并提供资源导航。

错误处理
---------------------

若调用出错，也是返回JSON格式的结果，但结构与正常的调用不一样，错误返回值结构如下：

	{
	  "code": "ehr.user.invalid.id",
	  "message": "此用户ID不存在",
	  "internalMessage": "No car found in the database",
	  "code": 34,
	  "more info": "http://dev.yihu.com/blog/rest/v1/errors/ehr.user.invalid.id"
	}
	
鉴权（Authentication）
---------------------

RESTful API是无状态的也就是说用户请求的鉴权和cookie以及session无关，每一次请求都应该包含鉴权证明。
平台通过使用SSL可以不用每次都提供用户名和密码：用户初次使用用户名与密码登录时，平台给用户返回一个随机产生的token。
如果不方便，可以使用OAuth 2来进行token的安全传输。
支持jsonp的API需要额外的鉴权方法，因为jsonp请求无法发送普通的credential。这种情况下可以在查询url中添加参数：access_token。注意使用url参数的问题是：目前大部分的网络服务器都会讲query参数保存到服务器日志中，这可能会成为大的安全风险。
注意上面说到的只是三种传输token的方法，实际传输的token可能是一样的。


API接口的系统参数（公共参数）
---------------------

第三方在发起API调用的请求时，除了需要包含具体API自身需要的参数之外，还至少需要包含下表中列出的几个标记为required的系统参数，
对于某些API调用，session key和ss也是必须传递的。其中，api_key, method, session_key, ss, ie, format, v这7个参数建议采用GET参数传递，其余参数建议放在POST参数中传递。 

参数签名算法
---------------------

向平台服务器发送请求HTTP请求时，需要为请求参数算一个签名作为bd_sig参数的值，并将bd_sig参数作为HTTP请求参数的一部分传递给Rest服务器，
以便平台确认请求确实来自当前第三方应用，而不是他人伪造。需要注意的是，计算签名时不能将bd_sig参数包含在内。 